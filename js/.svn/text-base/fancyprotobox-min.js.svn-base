var ie=navigator.userAgent.match(/MSIE\s(\d)+/);if(ie){var version=parseInt(ie[1]);Prototype.Browser["IE"+version.toString()]=true;Prototype.Browser.ltIE7=(version<7)?true:false}Object.extend(String.prototype,{ensureEndsWith:function(a){return this.endsWith(a)?this:this+a},px:function(){return this.ensureEndsWith("px")}});Object.extend(Number.prototype,{px:function(){return this.toString().px()}});var FancyProtoBox={};(function(){var e=false,j=false,l=false,a=null;var n,p=1,g=new Image,i=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i;var f,o,m,k,q,b,c;function r(t){var u=t.getStyle("background-image");var s=t.getStyle("position");if(u.match(/^url\(["']?(.*\.png)["']?\)$/i)){u=RegExp.$1;t.setStyle({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(t.getStyle("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+u+"')"});if(s!="absolute"&&s!="relative"){t.setStyle({position:"relative"})}}}function h(){var t=document.viewport.getDimensions();var s=document.viewport.getScrollOffsets();return{width:t.width,height:t.height,left:s.left,top:s.top}}function d(){if(e){return}e=true;l=false;var s='<div id="fancy_overlay" style="display: none;"></div>';s+='<div id="fancy_loading" style="display: none;"><div></div></div>';s+='<div id="fancy_outer" style="display: none;">';s+='<div id="fancy_inner">';s+='<div id="fancy_close"></div>';s+='<div id="fancy_bg"><div class="fancy_bg" id="fancy_bg_n"></div><div class="fancy_bg" id="fancy_bg_ne"></div><div class="fancy_bg" id="fancy_bg_e"></div><div class="fancy_bg" id="fancy_bg_se"></div><div class="fancy_bg" id="fancy_bg_s"></div><div class="fancy_bg" id="fancy_bg_sw"></div><div class="fancy_bg" id="fancy_bg_w"></div><div class="fancy_bg" id="fancy_bg_nw"></div></div>';s+='<div id="fancy_content"></div>';s+="</div>";s+="</div>";s+='<div id="fancy_title" style="display: none;"><table cellspacing="0" cellpadding="0" border="0"><tr><td class="fancy_title" id="fancy_title_left"></td><td class="fancy_title" id="fancy_title_main"><div></div></td><td class="fancy_title" id="fancy_title_right"></td></tr></table></div>';$$("body").first().insert(s);f=$("fancy_overlay");o=$("fancy_loading");m=$("fancy_outer");k=$("fancy_inner");q=$("fancy_bg");b=$("fancy_close");c=$("fancy_content");_title=$("fancy_title");b.observe("click",FancyProtoBox.hide);if(Prototype.Browser.IE){q.select(".fancy_bg").each(function(u){r(u)});$$("#fancy_loading div, #fancy_close, .fancy_title, .fancy_ico").each(function(u){r(u)});k.insert({top:'<iframe id="fancy_bigIframe" src="javascript:false;" scrolling="no" frameborder="0"></iframe>'});var t=$("fancy_bigIframe").contentWindow.document;t.open();t.close()}}FancyProtoBox=Class.create({initialize:function(s){this.options=Object.extend({animationDuration:0.4,frameWidth:560,frameHeight:340,padding:10,overlayShow:true,overlayOpacity:0.4,overlayColor:"#666",hideOnOverlayClick:true,hideOnContentClick:true,centerOnScroll:true,callbackOnShow:null,callbackOnClose:null,title:"",titleShow:true},arguments[1]||{});d();this.element=$(s);this.inline=false;if(this.element&&this.element.tagName.toUpperCase()=="A"){this.element.observe("click",this.show.bind(this))}},show:function(v){if(v){v.stop()}if(j){return}j=true;l=true;a=this;var t=h();this.originY=v?v.pointerY():((t.height/2)+t.top);this.originX=v?v.pointerX():(t.width/2);this.item={title:""};if(this.element){if(this.element.tagName.toUpperCase()=="A"){this.item.href=this.element.readAttribute("href");this.item.title=this.element.readAttribute("title");if(this.item.href.match("iframe")||this.element.className.indexOf("iframe")>=0){this._showLoading();this._processFrame()}else{if(this.item.href.match(/#/)){this.inline=true;this.item.content=$(this.item.href.gsub(/^#/,""))}else{if(this.item.href.match(i)){g=new Image;g.src=this.item.href;if(g.complete){this._processImage()}else{this._showLoading();g.onload=this._processImage.bind(this)}}else{this._showLoading();this._processAjax()}}}}else{if(this.element.tagName.toUpperCase()=="DIV"){this.inline=true;this.item.content=this.element}}if(this.inline&&this.item.content){var u=new Element("div",{id:"fancy_div"});var w=this.options.width?this.options.width:this.item.content.getWidth();var s=this.options.height?this.options.height:this.item.content.getHeight();this.item.content.immediateDescendants().each(function(x){u.insert(x.remove())});this._showContent(u,w,s,this.item.title)}}},hide:function(s){if(s){s.stop()}if(j){return}j=true;new Effect.Parallel([new Effect.Fade(f,{sync:true}),new Effect.Move(m,{x:this.moveX*-1,y:this.moveY*-1,sync:true}),new Effect.Morph(m,{style:{width:"1".px(),height:"1".px()},sync:true,beforeStart:this._cleanupContent.bind(this),afterFinish:function(t){j=false;a=null}}),new Effect.Fade(m,{sync:true})],{duration:this.options.animationDuration});this._unbindEventHandlers();if(this.options.callbackOnClose){this.options.callbackOnClose()}},_showContent:function(t,v,w,B){var z=this.options.padding;var s=h();var u=v;var C=w;var y=B&&this.options.titleShow?B:"";if(this.options.title.length>0&&this.options.titleShow){y=this.options.title}this._bindEventHandlers();if(Prototype.Browser.ltIE7){c.style.removeExpression("height");c.style.removeExpression("width")}if(z>0){u+=z*2;C+=z*2;c.setStyle({top:z.px(),right:z.px(),bottom:z.px(),left:z.px(),width:"auto",height:"auto"});if(Prototype.Browser.ltIE7){c.style.setExpression("height","(this.parentNode.clientHeight - "+z*2+")");c.style.setExpression("width","(this.parentNode.clientWidth - "+z*2+")")}}else{c.setStyle({top:0,right:0,bottom:0,left:0,width:"100%",height:"100%"})}if(this.options.overlayShow){if(Prototype.Browser.ltIE7){f.setStyle({height:s.height.px(),position:"absolute",top:s.top.px()})}f.setStyle({backgroundColor:this.options.overlayColor,opacity:this.options.overlayOpacity})}else{f.setStyle({backgroundColor:"transparent",opacity:0})}var x=Math.max((s.height/2)-((C+60)/2)+s.top,0);var A=(s.width/2)-((u+40)/2);this.moveX=-(this.originX-A);this.moveY=-(this.originY-x);m.hide().setStyle({position:"absolute",top:this.originY.px(),left:this.originX.px()});new Effect.Parallel([new Effect.Appear(f,{sync:true,to:this.options.overlayOpacity}),new Effect.Appear(m,{sync:true}),new Effect.Move(m,{x:this.moveX,y:this.moveY,sync:true}),new Effect.Morph(m,{style:{width:u.px(),height:C.px()},sync:true,afterFinish:this._insertContent.bind(this,t)})],{duration:this.options.animationDuration})},_insertContent:function(t){c.update("").cleanWhitespace();c.insert(t);if(typeof title!=="undefined"&&title.length>0){var s=m.viewportOffset();_title.down("div").update(title);_title.setStyle({top:(s.top+m.getHeight()+dimensions.top-32).px(),left:(s.left+(m.getWidth()*0.5)-(_title.getWidth()*0.5)).px()});_title.show()}b.show();o.hide();j=false;if(this.options.callbackOnShow){this.options.callbackOnShow()}},_cleanupContent:function(t){if(this.inline){var s=this.item.content;c.immediateDescendants().each(function(u){s.insert(u.remove())})}c.innerHTML="";_title.down("div").update("");l=false;b.hide();_title.hide();o.hide()},_processFrame:function(){this.frame_element=new Element("iframe",{id:"fancy_frame",name:"fancy_iframe"+Math.round(Math.random()*1000),frameborder:"0",hspace:"0",src:this.item.href});var t=this.options.width?this.options.width:this.options.frameWidth;var s=this.options.height?this.options.height:this.options.frameWidth;this._showContent(this.frame_element,t,s,this.item.title)},_processAjax:function(){new Ajax.Request(this.item.href,{method:"get",onSuccess:this._processAjaxRequest.bind(this),onFailure:function(){console.log("Something went wrong...")}})},_processAjaxRequest:function(v){var t=new Element("div",{id:"fancy_ajax"}).update(v.responseText);var u=this.options.width?this.options.width:this.options.frameWidth;var s=this.options.height?this.options.height:this.options.frameWidth;this._showContent(t,u,s,this.item.title)},_processImage:function(){var t=g.width;var s=g.height;var x=(this.options.padding*2)+40;var w=(this.options.padding*2)+60;var v=h();var u=new Element("img",{id:"fancy_img",src:g.src});this._showContent(u,t,s,this.item.title)},_showLoading:function(){clearInterval(n);var s=h();o.setStyle({left:((s.width-40)*0.5+s.left).px(),top:((s.height-40)*0.5+s.top).px()});o.observe("click",this.hide.bind(this));o.show();loadingTimer=setInterval(this._animateLoading,66)},_animateLoading:function(){if(!o.visible()){clearInterval(n);return}o.firstDescendant().setStyle({top:(p*-40).px()});p=(p+1)%12},_bindEventHandlers:function(){this._boundBodyClickHandler=this._bodyClickHandler.bind(this);this._boundEscKeyHandler=this._escKeyHandler.bind(this);this._boundWindowChangeHandler=this._windowChangeHandler.bind(this);Event.observe($$("html").first(),"click",this._boundBodyClickHandler);Event.observe(document,"keyup",this._boundEscKeyHandler);Event.observe(window,"resize",this._boundWindowChangeHandler);Event.observe(window,"scroll",this._boundWindowChangeHandler)},_unbindEventHandlers:function(){Event.stopObserving($$("html").first(),"click",this._boundBodyClickHandler);Event.stopObserving(document,"keyup",this._boundEscKeyHandler);Event.stopObserving(window,"resize",this._boundWindowChangeHandler);Event.stopObserving(window,"scroll",this._boundWindowChangeHandler)},_imageLoadedHandler:function(s){o.hide();this._processImage()},_windowChangeHandler:function(w){if(l){var v=h();if(this.options.centerOnScroll){var u=m.getWidth();var t=m.getHeight();m.setStyle({top:(t>v.height?v.top:v.top+Math.round((v.height-t)*0.5)).px(),left:(u>v.width?v.left:v.left+Math.round((v.width-u)*0.5)).px()});if(_title.visible()){var s=m.viewportOffset();_title.setStyle({top:(s.top+m.getHeight()+v.top-32).px(),left:(s.left+(m.getWidth()*0.5)-(_title.getWidth()*0.5)).px()})}}if(Prototype.Browser.ltIE7){f.setStyle({height:document.viewport.getHeight().px(),top:v.top.px()})}}},_bodyClickHandler:function(t){var s=t.findElement("#fancy_outer");if(l&&(!s||this.options.hideOnContentClick)){this.hide(t)}},_escKeyHandler:function(s){if(s.keyCode==Event.KEY_ESC&&visible){this.hide(s)}}});Object.extend(FancyProtoBox,{init:function(s){var t=arguments[1]||{};$$(s).each(function(u){new FancyProtoBox(u,t)})},hide:function(s){if(l){a.hide(s)}},isVisible:function(){return l}})})();